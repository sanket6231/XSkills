
@{
    ViewBag.Title = "Scratch Pad";
}

<link href="~/Content/Site.css" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link href="~/Content/posts.css" rel="stylesheet" />
<style type="text/css">

    img {
        height: 150px;
        width: 150px;
    }

    .post-comments {
        padding-bottom: 9px;
        margin: 5px 0 5px;
    }

    .comments-nav {
        border-bottom: 1px solid #eee;
        margin-bottom: 5px;
    }

    .post-comments .comment-meta {
        border-bottom: 1px solid #eee;
        margin-bottom: 5px;
    }

    .post-comments .media {
        border-left: 1px dotted #000;
        border-bottom: 1px dotted #000;
        margin-bottom: 5px;
        padding-left: 10px;
    }

    .post-comments .media-heading {
        font-size: 12px;
        color: grey;
    }

    .post-comments .comment-meta a {
        font-size: 12px;
        color: grey;
        font-weight: bolder;
        margin-right: 5px;
    }
</style>
<div class="container">
    <div class="row profile">
        <div class="col-md-3">
            @{Html.RenderAction("LoginHome", "Home", new { pagename = "Scratch Pad" });}
        </div>
        <div class="col-md-9">

            <div class="profile-content" id="MainContent" style="height: 70vh;overflow-x: scroll; overflow-y: scroll;">
                <p>
                    <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                        See All Comments
                    </a>
                </p>
                <div class="collapse" id="collapseExample">
                    <div class="card card-body">
                        @Html.Action("CommentPartial")
                    </div>
                </div>
                <div class="container col-md-12" >
                    <div class="post-comments">
                        @*<form>
                    <div class="form-group">
                        <label for="comment">Your Comment</label>
                        <textarea name="comment" class="form-control" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-default">Send</button>
                </form>*@
                        <div class="comments-nav">
                            <ul class="nav nav-pills">
                                <li role="presentation" class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                                        there are 2593 comments <span class="caret"></span>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">Best</a></li>
                                        <li><a href="#">Hot</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div class="row">
                            <div class="media">
                                <!-- first comment -->
                                <div class="media-heading">
                                    <button class="btn btn-default btn-xs" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseExample"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button> <span class="label label-info">12314</span> terminator 12 hours ago
                                </div>
                                <div class="panel-collapse collapse in" id="collapseOne">
                                    <div class="media-left">
                                        <div class="vote-wrap">
                                            <div class="save-post">
                                                <a href="#"><span class="glyphicon glyphicon-star" aria-label="Save"></span></a>
                                            </div>
                                            <div class="vote up">
                                                <i class="glyphicon glyphicon-menu-up"></i>
                                            </div>
                                            <div class="vote inactive">
                                                <i class="glyphicon glyphicon-menu-down"></i>
                                            </div>
                                        </div>
                                        <!-- vote-wrap -->
                                    </div>
                                    <!-- media-left -->

                                    <div class="media-body">
                                        <p>Hi, I just saw you have completed Azure certification. I am also planning for the same. Can you help me with the contents?</p>
                                        <div class="comment-meta">
                                            <span><a href="#">delete</a></span>
                                            <span><a href="#">report</a></span>
                                            <span><a href="#">hide</a></span>
                                            <span>
                                                <a class="" role="button" data-toggle="collapse" href="#replyCommentT" aria-expanded="false" aria-controls="collapseExample">reply</a>
                                            </span>
                                            <div class="collapse" id="replyCommentT">
                                                <form>
                                                    <div class="form-group">
                                                        <label for="comment">Your Comment</label>
                                                        <textarea name="comment" class="form-control" rows="3"></textarea>
                                                    </div>
                                                    <button type="submit" class="btn btn-default">Send</button>
                                                </form>
                                            </div>
                                        </div>
                                        <!-- comment-meta -->
                                        <div class="media">
                                            <!-- answer to the first comment -->
                                            <div class="media-heading">
                                                <button class="btn btn-default btn-collapse btn-xs" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseExample"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button> <span class="label label-info">12314</span> Comments
                                            </div>
                                            <div class="panel-collapse collapse in" id="collapseTwo">
                                                <div class="media-left">
                                                    <div class="vote-wrap">
                                                        <div class="save-post">
                                                            <a href="#"><span class="glyphicon glyphicon-star" aria-label="Save"></span></a>
                                                        </div>
                                                        <div class="vote up">
                                                            <i class="glyphicon glyphicon-menu-up"></i>
                                                        </div>
                                                        <div class="vote inactive">
                                                            <i class="glyphicon glyphicon-menu-down"></i>
                                                        </div>
                                                    </div>
                                                    <!-- vote-wrap -->
                                                </div>
                                                <!-- media-left -->

                                                <div class="media-body">
                                                    <p>Yeah Sure! Start learning from official website. It has all the content and explained very well..</p>
                                                    <div class="comment-meta">
                                                        <span><a href="#">delete</a></span>
                                                        <span><a href="#">report</a></span>
                                                        <span><a href="#">hide</a></span>
                                                        <span>
                                                            <a class="" role="button" data-toggle="collapse" href="#replyCommentThree" aria-expanded="false" aria-controls="collapseExample">reply</a>
                                                        </span>
                                                        <div class="collapse" id="replyCommentThree">
                                                            <form>
                                                                <div class="form-group">
                                                                    <label for="comment">Your Comment</label>
                                                                    <textarea name="comment" class="form-control" rows="3"></textarea>
                                                                </div>
                                                                <button type="submit" class="btn btn-default">Send</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    <!-- comment-meta -->
                                                </div>
                                            </div>
                                            <!-- comments -->
                                        </div>
                                        <!-- answer to the first comment -->
                                    </div>
                                </div>
                                <!-- comments -->
                            </div>
                            <!-- first comment -->
                            <div class="media">
                                <!-- first comment -->
                                <div class="media-heading">
                                    <button class="btn btn-default btn-xs" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseExample"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button> <span class="label label-info">12314</span> vertu 12 sat once yazmis
                                </div>
                                <div class="panel-collapse collapse in" id="collapseThree">
                                    <div class="media-left">
                                        <div class="vote-wrap">
                                            <div class="save-post">
                                                <a href="#"><span class="glyphicon glyphicon-star" aria-label="Kaydet"></span></a>
                                            </div>
                                            <div class="vote up">
                                                <i class="glyphicon glyphicon-menu-up"></i>
                                            </div>
                                            <div class="vote inactive">
                                                <i class="glyphicon glyphicon-menu-down"></i>
                                            </div>
                                        </div>
                                        <!-- vote-wrap -->
                                    </div>
                                    <!-- media-left -->

                                    <div class="media-body">
                                        <p>Hi, I just saw you have completed Azure certification. I am also planning for the same. Can you help me with the contents?</p>
                                        <div class="comment-meta">
                                            <span><a href="#">sil</a></span>
                                            <span><a href="#">kaydet</a></span>
                                            <span><a href="#">sikayer et</a></span>
                                            <span>
                                                <a class="" role="button" data-toggle="collapse" href="#replyCommentFour" aria-expanded="false" aria-controls="collapseExample">cevapla</a>
                                            </span>
                                            <div class="collapse" id="replyCommentFour">
                                                <form>
                                                    <div class="form-group">
                                                        <label for="comment">Yorumunuz</label>
                                                        <textarea name="comment" class="form-control" rows="3"></textarea>
                                                    </div>
                                                    <button type="submit" class="btn btn-default">Yolla</button>
                                                </form>
                                            </div>
                                        </div>
                                        <!-- comment-meta -->
                                        <div class="media">
                                            <!-- answer to the first comment -->
                                            <div class="media-heading">
                                                <button class="btn btn-default btn-collapse btn-xs" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseExample"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button> <span class="label label-info">12314</span> vertu 12 sat once yazmis
                                            </div>
                                            <div class="panel-collapse collapse in" id="collapseFour">
                                                <div class="media-left">
                                                    <div class="vote-wrap">
                                                        <div class="save-post">
                                                            <a href="#"><span class="glyphicon glyphicon-star" aria-label="Kaydet"></span></a>
                                                        </div>
                                                        <div class="vote up">
                                                            <i class="glyphicon glyphicon-menu-up"></i>
                                                        </div>
                                                        <div class="vote inactive">
                                                            <i class="glyphicon glyphicon-menu-down"></i>
                                                        </div>
                                                    </div>
                                                    <!-- vote-wrap -->
                                                </div>
                                                <!-- media-left -->

                                                <div class="media-body">
                                                    <p>Yeah Sure! Start learning from official website. It has all the content and explained very well..</p>
                                                    <div class="comment-meta">
                                                        <span><a href="#">sil</a></span>
                                                        <span><a href="#">kaydet</a></span>
                                                        <span><a href="#">sikayer et</a></span>
                                                        <span>
                                                            <a class="" role="button" data-toggle="collapse" href="#replyCommentFive" aria-expanded="false" aria-controls="collapseExample">cevapla</a>
                                                        </span>
                                                        <div class="collapse" id="replyCommentFive">
                                                            <form>
                                                                <div class="form-group">
                                                                    <label for="comment">Yorumunuz</label>
                                                                    <textarea name="comment" class="form-control" rows="3"></textarea>
                                                                </div>
                                                                <button type="submit" class="btn btn-default">Yolla</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    <!-- comment-meta -->
                                                    <div class="media">
                                                        <!-- first comment -->
                                                        <div class="media-heading">
                                                            <button class="btn btn-default btn-xs" type="button" data-toggle="collapse" data-target="#collapseFive" aria-expanded="false" aria-controls="collapseExample"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button> <span class="label label-info">12314</span> vertu 12 sat once yazmis
                                                        </div>
                                                        <div class="panel-collapse collapse in" id="collapseFive">
                                                            <div class="media-left">
                                                                <div class="vote-wrap">
                                                                    <div class="save-post">
                                                                        <a href="#"><span class="glyphicon glyphicon-star" aria-label="Kaydet"></span></a>
                                                                    </div>
                                                                    <div class="vote up">
                                                                        <i class="glyphicon glyphicon-menu-up"></i>
                                                                    </div>
                                                                    <div class="vote inactive">
                                                                        <i class="glyphicon glyphicon-menu-down"></i>
                                                                    </div>
                                                                </div>
                                                                <!-- vote-wrap -->
                                                            </div>
                                                            <!-- media-left -->

                                                            <div class="media-body">
                                                                <p>yazmayın artık amk, görmeyeyim sol framede. insan bi meraklanıyor, ümitleniyor. sonra yine özlem dolu yazıları görüp hayal kırıklığıyla okuyorum.</p>
                                                                <div class="comment-meta">
                                                                    <span><a href="#">sil</a></span>
                                                                    <span><a href="#">kaydet</a></span>
                                                                    <span><a href="#">sikayer et</a></span>
                                                                    <span>
                                                                        <a class="" role="button" data-toggle="collapse" href="#replyCommentSix" aria-expanded="false" aria-controls="collapseExample">cevapla</a>
                                                                    </span>
                                                                    <div class="collapse" id="replyCommentSix">
                                                                        <form>
                                                                            <div class="form-group">
                                                                                <label for="comment">Yorumunuz</label>
                                                                                <textarea name="comment" class="form-control" rows="3"></textarea>
                                                                            </div>
                                                                            <button type="submit" class="btn btn-default">Yolla</button>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                                <!-- comment-meta -->
                                                                <div class="media">
                                                                    <!-- answer to the first comment -->
                                                                    <div class="media-heading">
                                                                        <button class="btn btn-default btn-collapse btn-xs" type="button" data-toggle="collapse" data-target="#collapseSix" aria-expanded="false" aria-controls="collapseExample"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button> <span class="label label-info">12314</span> vertu 12 sat once yazmis
                                                                    </div>
                                                                    <div class="panel-collapse collapse in" id="collapseSix">
                                                                        <div class="media-left">
                                                                            <div class="vote-wrap">
                                                                                <div class="save-post">
                                                                                    <a href="#"><span class="glyphicon glyphicon-star" aria-label="Kaydet"></span></a>
                                                                                </div>
                                                                                <div class="vote up">
                                                                                    <i class="glyphicon glyphicon-menu-up"></i>
                                                                                </div>
                                                                                <div class="vote inactive">
                                                                                    <i class="glyphicon glyphicon-menu-down"></i>
                                                                                </div>
                                                                            </div>
                                                                            <!-- vote-wrap -->
                                                                        </div>
                                                                        <!-- media-left -->

                                                                        <div class="media-body">
                                                                            <p>yazmayın artık amk, görmeyeyim sol framede. insan bi meraklanıyor, ümitleniyor. sonra yine özlem dolu yazıları görüp hayal kırıklığıyla okuyorum.</p>
                                                                            <div class="comment-meta">
                                                                                <span><a href="#">sil</a></span>
                                                                                <span><a href="#">kaydet</a></span>
                                                                                <span><a href="#">sikayer et</a></span>
                                                                                <span>
                                                                                    <a class="" role="button" data-toggle="collapse" href="#replyCommentOne" aria-expanded="false" aria-controls="collapseExample">cevapla</a>
                                                                                </span>
                                                                                <div class="collapse" id="replyCommentOne">
                                                                                    <form>
                                                                                        <div class="form-group">
                                                                                            <label for="comment">Yorumunuz</label>
                                                                                            <textarea name="comment" class="form-control" rows="3"></textarea>
                                                                                        </div>
                                                                                        <button type="submit" class="btn btn-default">Yolla</button>
                                                                                    </form>
                                                                                </div>
                                                                            </div>
                                                                            <!-- comment-meta -->

                                                                        </div>
                                                                    </div>
                                                                    <!-- comments -->
                                                                </div>
                                                                <!-- answer to the first comment -->
                                                            </div>
                                                        </div>
                                                        <!-- comments -->
                                                    </div>
                                                    <!-- first comment -->
                                                </div>
                                            </div>
                                            <!-- comments -->
                                        </div>
                                        <!-- answer to the first comment -->
                                    </div>
                                </div>
                                <!-- comments -->
                            </div>
                            <!-- first comment -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script id="comment-template" type="text/x-handlebars-template">
    <li class="comment" data-id="{{commentId}}">
        <div class="row">
            <div class="col-md-1">
                <div class="avatar">
                    <a href="javascript:void(0);">
                        <img src="{{ImgUrl}}" style="height:30px;width:30px;border-radius:50%;" />
                    </a>
                </div>
            </div>
            <div class="col-md-11">
                <div class="comment-body">
                    <header>
                        <a href="javascript:void(0);" class="userlink">{{username}}</a> - <span class="pubdate">
                            posted {{strCommentDate}}
                        </span>
                    </header>
                    <p>
                        {{commentText}}
                    </p>
                    <footer>
                        <a class="reply-link" href="{{commentId}}">Reply</a>
                    </footer>
                </div>
            </div>
        </div>
    </li>
</script>

<script id="reply-template" type="text/template">
    <div style="padding-top:10px" class="row reply-form">
        <div class="row">
            <div class="col-md-1">
                <div class="avatar">
                    <img class="profile_image" src="/UploadedFiles/Images/profiles/User-blue-icon.png" style="height:30px;width:30px;border-radius:50%;" />
                </div>
            </div>
            <div class="col-md-10">
                <input type="text" cols="15" id="replyInput" class="form-control" placeholder="Add a reply.." />
            </div>
            <div class="col-md-1 text-left">
                <a class="addReplyBtn" href="#"><i class="fa fa-send fa_custom fa-2x"></i></a>
                <input type="hidden" name="hidParentId" id="hidParentId" class="hidParentId" />
            </div>
        </div>
    </div>
</script>

@section scripts{
    <script src="~/Scripts/handlebars-v4.0.12.js"></script>
    <script>

        function addNewComment(data) {
            return $.ajax({
                type: "POST",
                url: '@Url.Action("addNewComment", "ScratchPad")',
                data: data,
                dataType: 'json',
                contentType: 'application/json;charset=utf-8'
            });
        }



    $(function () {

        var source = document.getElementById("comment-template").innerHTML;
        var template = Handlebars.compile(source);


        $("#addNewCommentBtn").click(function (e) {
            e.preventDefault();
            var data = JSON.stringify({
                parentId: 0,
                commentText: $("#commentInput").val()
            });


            $.when(addNewComment(data)).then(function (response) {
                if (response.error == false) {
                    var $commentHtml = template(response.result);
                    $(".comments").append($commentHtml);
                    $("#commentInput").val('');
                } else {
                    console.log("An error has occured");
                }
            }).fail(function (err) {
                console.log(err);
            })
        });


        $(document).on("click", ".reply-link", function (e) {
            e.preventDefault();
            var $self = $(this);
            var $commentListItem = $self.parents(".comment-body");
            var replySource = document.getElementById("reply-template").innerHTML;
            $commentListItem.after(replySource);

            $(document).find(".hidParentId").val($self.attr("href"));

        });



        $(document).on("click", ".addReplyBtn", function (e) {
            e.preventDefault();
            var $self = $(this);
            var $replyInput = $(document).find("#replyInput");
            var parentId = $(document).find(".hidParentId").val();
            var $repliesUL = $(document).find("ul[data-parentid='" + parentId + "']");
            var $commentBody = $(document).find("li[data-id='" + parentId + "']");
            var replyULCount = $repliesUL.length;



            var data = JSON.stringify({
                parentId: parentId,
                commentText: $replyInput.val()
            });

            $.when(addNewComment(data)).then(function (response) {
                if (response.error == false) {
                    var commentHtml = template(response.result);

                    if (replyULCount > 0) {

                        $repliesUL.append(commentHtml);
                    } else {

                        $commentBody.append("<ul class='replies'></ul>")
                            .append(commentHtml);
                    }

                    $(document).find(".reply-form").remove();

                } else {
                    console.log("An error has occured");
                }
            }).fail(function (err) {
                console.log(err);
            })

        });



        });

        $(document).ready(function () {
            var imgsrc = $('.profile-userpic img').attr('src');
            $('.profile_image').attr('src', imgsrc);
        });
    </script>


}



<script>
    $('[data-toggle="collapse"]').on('click', function () {
        var $this = $(this),
            $parent = typeof $this.data('parent') !== 'undefined' ? $($this.data('parent')) : undefined;
        if ($parent === undefined) { /* Just toggle my  */
            $this.find('.glyphicon').toggleClass('glyphicon-plus glyphicon-minus');
            return true;
        }

        /* Open element will be close if parent !== undefined */
        var currentIcon = $this.find('.glyphicon');
        currentIcon.toggleClass('glyphicon-plus glyphicon-minus');
        $parent.find('.glyphicon').not(currentIcon).removeClass('glyphicon-minus').addClass('glyphicon-plus');

    });

</script>
